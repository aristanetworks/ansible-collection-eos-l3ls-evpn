
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Arista Validated Design collection's documentation">
      
      
        <meta name="author" content="Arista Ansible Team">
      
      
      
        <link rel="prev" href="../../docs/getting-started/intro-to-ansible-and-avd.html">
      
      
        <link rel="next" href="../../docs/installation/collection-installation.html">
      
      <link rel="icon" href="../../docs/_media/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.0.15">
    
    
      
        <title>Example for Single DC L3LS - Arista AVD collection</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.113286f1.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CFira+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Fira Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../docs/stylesheets/extra.material.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#avd-example-for-a-single-data-center-using-layer-3-leaf-spine-l3ls" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="Arista AVD collection" class="md-header__button md-logo" aria-label="Arista AVD collection" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M96 0C43 0 0 43 0 96v320c0 53 43 96 96 96h320c17.7 0 32-14.3 32-32s-14.3-32-32-32v-64c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H96zm0 384h256v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Arista AVD collection
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Example for Single DC L3LS
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/aristanetworks/ansible-avd" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    AVD on Github
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="Arista AVD collection" class="md-nav__button md-logo" aria-label="Arista AVD collection" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M96 0C43 0 0 43 0 96v320c0 53 43 96 96 96h320c17.7 0 32-14.3 32-32s-14.3-32-32-32v-64c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H96zm0 384h256v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/></svg>

    </a>
    Arista AVD collection
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aristanetworks/ansible-avd" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    AVD on Github
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/getting-started/intro-to-ansible-and-avd.html" class="md-nav__link">
        Introduction to Ansible and AVD
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Example for Single DC L3LS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="index.html" class="md-nav__link md-nav__link--active">
        Example for Single DC L3LS
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overall-design-overview" class="md-nav__link">
    Overall design overview
  </a>
  
    <nav class="md-nav" aria-label="Overall design overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#physical-topology" class="md-nav__link">
    Physical topology
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip-ranges-used" class="md-nav__link">
    IP ranges used
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bgp-design" class="md-nav__link">
    BGP Design
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-eos-config" class="md-nav__link">
    Basic EOS config
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ansible-inventory-group-vars-and-naming-scheme" class="md-nav__link">
    Ansible inventory, group vars and naming scheme
  </a>
  
    <nav class="md-nav" aria-label="Ansible inventory, group vars and naming scheme">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#content-of-the-inventoryyml-file" class="md-nav__link">
    Content of the inventory.yml file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-device-types" class="md-nav__link">
    Defining device types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-fabric-wide-configuration-parameters" class="md-nav__link">
    Setting fabric-wide configuration parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-device-specific-configuration-parameters" class="md-nav__link">
    Setting device specific configuration parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specifying-network-services-vrfs-and-vlans-in-the-evpnvxlan-fabric" class="md-nav__link">
    Specifying network services (VRFs and VLANs) in the EVPN/VXLAN Fabric
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specifying-endpoint-connectivity-in-the-evpnvxlan-fabric" class="md-nav__link">
    Specifying endpoint connectivity in the EVPN/VXLAN Fabric
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-playbook" class="md-nav__link">
    The playbook
  </a>
  
    <nav class="md-nav" aria-label="The playbook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-avd-output-without-a-lab" class="md-nav__link">
    Testing AVD output without a lab
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#executing-the-playbook" class="md-nav__link">
    Executing the playbook
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evpn-not-working" class="md-nav__link">
    EVPN not working
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/installation/collection-installation.html" class="md-nav__link">
        Collection Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/installation/requirements.html" class="md-nav__link">
        Requirements
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          How-To
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          How-To
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/how-to/first-project.html" class="md-nav__link">
        Build Your First AVD Project
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/how-to/first-cvp-avd-project.html" class="md-nav__link">
        Build Your First AVD & CVP Project
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/how-to/lab-with-nat.html" class="md-nav__link">
        Use NAT Gateway With eAPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/how-to/tower-integration.html" class="md-nav__link">
        AWX & Tower Integration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/how-to/ztp.html" class="md-nav__link">
        Configure ZTP Server With CVP Collection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/how-to/vscode-container.html" class="md-nav__link">
        Setup Ansible AVD With VS Code Container
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Roles Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Roles Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
      
      
      
        <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
          eos_designs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          eos_designs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_designs/index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_designs/doc/connected-endpoints.html" class="md-nav__link">
        Connected Endpoints
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_designs/doc/l3-edge.html" class="md-nav__link">
        DCI & L3 Edge
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_designs/doc/fabric-topology.html" class="md-nav__link">
        Fabric Topology
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_designs/doc/fabric-variables.html" class="md-nav__link">
        Fabric Variables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_designs/doc/management-settings.html" class="md-nav__link">
        Management Settings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_designs/doc/network-services.html" class="md-nav__link">
        Network Services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_designs/doc/node-types.html" class="md-nav__link">
        Node Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_designs/doc/platform-settings.html" class="md-nav__link">
        Platform Specific Settings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_designs/doc/custom-structured-configuration.html" class="md-nav__link">
        Custom Structured Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_11" >
      
      
      
        <label class="md-nav__link" for="__nav_5_1_11" id="__nav_5_1_11_label" tabindex="0">
          MPLS Design (BETA)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_11_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_1_11">
          <span class="md-nav__icon md-icon"></span>
          MPLS Design (BETA)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_designs/doc/fabric-topology-mpls-BETA.html" class="md-nav__link">
        Fabric Topology MPLS (BETA)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_designs/doc/fabric-variables-mpls-BETA.html" class="md-nav__link">
        Fabric Variables MPLS (BETA)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_designs/doc/core-interfaces-BETA.html" class="md-nav__link">
        Core Interfaces (BETA)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_designs/doc/network-services-mpls-BETA.html" class="md-nav__link">
        Network Services MPLS (BETA)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_designs/doc/connected-endpoints-mpls-BETA.html" class="md-nav__link">
        Connected Endpoints MPLS (BETA)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_cli_config_gen/index.html" class="md-nav__link">
        eos_cli_config_gen
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/cvp_configlet_upload/index.html" class="md-nav__link">
        cvp_configlet_upload
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_config_deploy_cvp/index.html" class="md-nav__link">
        eos_config_deploy_cvp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_config_deploy_eapi/index.html" class="md-nav__link">
        eos_config_deploy_eapi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_validate_state/index.html" class="md-nav__link">
        eos_validate_state
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/eos_snapshot/index.html" class="md-nav__link">
        eos_snapshot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/dhcp_provisioner/index.html" class="md-nav__link">
        dhcp_provisioner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../roles/build_output_folders/index.html" class="md-nav__link">
        build_output_folders
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Modules Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Modules Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/modules/inventory_to_container.rst.html" class="md-nav__link">
        Module Inventory to Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/modules/configlet_build_config.rst.html" class="md-nav__link">
        Module Configlet Build Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../plugins/index.html" class="md-nav__link">
        AVD Plugins & Filters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://cvp.avd.sh/" class="md-nav__link">
        CloudVision Module Documentation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Contributing to AVD
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Contributing to AVD
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/contribution/overview.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/contribution/setup-environment.html" class="md-nav__link">
        Setup Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/contribution/setup-git.html" class="md-nav__link">
        Git Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/contribution/getting-started.html" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/contribution/style-guide.html" class="md-nav__link">
        Code Style
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/contribution/development.html" class="md-nav__link">
        Development Tips & Tricks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
      
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          External Resources
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          External Resources
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://docs.ansible.com/ansible/latest/user_guide/collections_using.html" class="md-nav__link">
        Ansible Collection User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://docs.ansible.com/ansible/latest/user_guide/index.html" class="md-nav__link">
        Ansible User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          Release Notes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Release Notes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/release-notes/3.x.x.html" class="md-nav__link">
        3.x.x
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/release-notes/2.x.x.html" class="md-nav__link">
        2.x.x
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/release-notes/1.1.x.html" class="md-nav__link">
        1.1.x
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/release-notes/1.0.x.html" class="md-nav__link">
        1.0.x
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
      
      
      
        <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
          About
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://galaxy.ansible.com/arista/avd" class="md-nav__link">
        AVD on Ansible Galaxy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://cvp.avd.sh/en/latest/" class="md-nav__link">
        Arista CVP Collection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/arista-netdevops-community/avd-install" class="md-nav__link">
        Arista Installation Script
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://aristanetworks.github.io/netdevops-examples/" class="md-nav__link">
        Arista NetDevOps Community
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overall-design-overview" class="md-nav__link">
    Overall design overview
  </a>
  
    <nav class="md-nav" aria-label="Overall design overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#physical-topology" class="md-nav__link">
    Physical topology
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip-ranges-used" class="md-nav__link">
    IP ranges used
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bgp-design" class="md-nav__link">
    BGP Design
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-eos-config" class="md-nav__link">
    Basic EOS config
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ansible-inventory-group-vars-and-naming-scheme" class="md-nav__link">
    Ansible inventory, group vars and naming scheme
  </a>
  
    <nav class="md-nav" aria-label="Ansible inventory, group vars and naming scheme">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#content-of-the-inventoryyml-file" class="md-nav__link">
    Content of the inventory.yml file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-device-types" class="md-nav__link">
    Defining device types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-fabric-wide-configuration-parameters" class="md-nav__link">
    Setting fabric-wide configuration parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-device-specific-configuration-parameters" class="md-nav__link">
    Setting device specific configuration parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specifying-network-services-vrfs-and-vlans-in-the-evpnvxlan-fabric" class="md-nav__link">
    Specifying network services (VRFs and VLANs) in the EVPN/VXLAN Fabric
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specifying-endpoint-connectivity-in-the-evpnvxlan-fabric" class="md-nav__link">
    Specifying endpoint connectivity in the EVPN/VXLAN Fabric
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-playbook" class="md-nav__link">
    The playbook
  </a>
  
    <nav class="md-nav" aria-label="The playbook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-avd-output-without-a-lab" class="md-nav__link">
    Testing AVD output without a lab
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#executing-the-playbook" class="md-nav__link">
    Executing the playbook
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evpn-not-working" class="md-nav__link">
    EVPN not working
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="avd-example-for-a-single-data-center-using-layer-3-leaf-spine-l3ls">AVD Example for a Single Data Center Using Layer 3 Leaf Spine (L3LS)<a class="headerlink" href="#avd-example-for-a-single-data-center-using-layer-3-leaf-spine-l3ls" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>This example is meant to be used as the logical second step introducing AVD to new users, directly following the <a href="../../docs/getting-started/intro-to-ansible-and-avd.html">Introduction to Ansible and AVD</a> section.
The idea is that new users with access to virtual switches (using Arista vEOS-lab or cEOS) can learn how to generate configuration and documentation for a complete fabric environment. Users with access to physical switches will have to adapt a few settings. This is all documented inline in the comments included in the YAML files. If a lab with virtual or physical switches is not accessible, fear not! This example can also be used to only generate the output from AVD if required.</p>
<p>The example includes and describes all the AVD files and their content used to build a Layer 3 Leaf Spine (L3LS) EVPN/VXLAN Symmetric IRB network covering a single DC, using the following:</p>
<ul>
<li>Two (virtual) spine switches.</li>
<li>Two sets of (virtual) leaf switches, serving endpoints such as servers.</li>
<li>Two (virtual) layer2-only switches often used for management connectivity to the servers.</li>
</ul>
<p>The example is meant as a simple starting point and more advanced examples will build upon this design to hopefully reduce any confusion when progressing.</p>
<p>Integration with CloudVision is not included in this example to keep everything as simple as possible, hence the Ansible host will communicate directly with the switches using eAPI.</p>
<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h2>
<p>Requirements to use this example:</p>
<ul>
<li>Follow the installation guide for AVD found <a href="../../docs/installation/collection-installation.html">here</a>.</li>
<li>Run the following playbook to copy the examples to your current working directory, for example <code>ansible-avd-examples</code>:</li>
</ul>
<p><code>ansible-playbook arista.avd.install_examples</code></p>
<p>This will show the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="w"> </span>~/ansible-avd-examples#<span class="w"> </span>ansible-playbook<span class="w"> </span>arista.avd.install_examples
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>PLAY<span class="w"> </span><span class="o">[</span>Install<span class="w"> </span>Examples<span class="o">]</span>***************************************************************************************************************************************************************************************************************************************************************
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>TASK<span class="w"> </span><span class="o">[</span>Copy<span class="w"> </span>all<span class="w"> </span>examples<span class="w"> </span>to<span class="w"> </span>~/ansible-avd-examples<span class="o">]</span>*****************************************************************************************************************************************************
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>changed:<span class="w"> </span><span class="o">[</span>localhost<span class="o">]</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>PLAY<span class="w"> </span>RECAP
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>****************************************************************************************************************************************************************************************************************************************************************************
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>localhost<span class="w">                  </span>:<span class="w"> </span><span class="nv">ok</span><span class="o">=</span><span class="m">1</span><span class="w">    </span><span class="nv">changed</span><span class="o">=</span><span class="m">1</span><span class="w">    </span><span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">failed</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">skipped</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">rescued</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">ignored</span><span class="o">=</span><span class="m">0</span>
</code></pre></div>
<p>After the playbook has run successfully, the directory structure will look as shown below, the contents of which will be covered in later sections:</p>
<ul>
<li>ansible-avd-examples/ (or wherever the playbook was run)<ul>
<li>single-dc-l3ls<ul>
<li>documentation/</li>
<li>group_vars/</li>
<li>images/</li>
<li>intended/</li>
<li>switch-basic-configurations/</li>
<li>ansible.cfg</li>
<li>inventory.yml</li>
<li>playbook.yml</li>
<li>README.md (this document)</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>Please note: If the content of any file in the example is <strong><em>modified</em></strong> and the playbook is run again, the file <strong><em>will not</em></strong> be overwritten.
However, if any file in the example is <strong><em>deleted</em></strong> and the playbook is run again, the file will be re-created.</p>
</blockquote>
<h2 id="overall-design-overview">Overall design overview<a class="headerlink" href="#overall-design-overview" title="Permanent link">&para;</a></h2>
<h3 id="physical-topology">Physical topology<a class="headerlink" href="#physical-topology" title="Permanent link">&para;</a></h3>
<p>The drawing below shows the physical topology used in this example. The interface assignment shown here are referenced across the entire example, so keep that in mind if this example must be adapted to a different topology. Finally, the Ansible host is connected to the dedicated out-of-band management port (Ethernet0 when using vEOS-lab):</p>
<p><img alt="Figure: Arista Leaf Spine physical topology" src="images/single-dc-topology-physical.png" /></p>
<h3 id="ip-ranges-used">IP ranges used<a class="headerlink" href="#ip-ranges-used" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Out-of-band management IP allocation for DC1</th>
<th>172.16.1.0/24</th>
</tr>
</thead>
<tbody>
<tr>
<td>Default gateway</td>
<td>172.16.1.1</td>
</tr>
<tr>
<td>dc1-spine1</td>
<td>172.16.1.11</td>
</tr>
<tr>
<td>dc1-spine2</td>
<td>172.16.1.12</td>
</tr>
<tr>
<td>dc1-leaf1a</td>
<td>172.16.1.101</td>
</tr>
<tr>
<td>dc1-leaf1b</td>
<td>172.16.1.102</td>
</tr>
<tr>
<td>dc1-leaf2a</td>
<td>172.16.1.103</td>
</tr>
<tr>
<td>dc1-leaf2b</td>
<td>172.16.1.104</td>
</tr>
<tr>
<td>dc1-leaf1c</td>
<td>172.16.1.151</td>
</tr>
<tr>
<td>dc1-leaf2c</td>
<td>172.16.1.152</td>
</tr>
<tr>
<td><strong>Point-to-point links between leaf and spine</strong></td>
<td><strong>(Underlay)</strong></td>
</tr>
<tr>
<td>DC1</td>
<td>10.255.255.0/26</td>
</tr>
<tr>
<td><strong>Loopback0 interfaces used for EVPN peering</strong></td>
<td>10.255.0.0/27</td>
</tr>
<tr>
<td><strong>Loopback1 interfaces used for VTEP</strong></td>
<td><strong>(Leaf switches)</strong></td>
</tr>
<tr>
<td>DC1</td>
<td>10.255.1.0/27</td>
</tr>
<tr>
<td><strong>VTEP Loopbacks used for diagnostics</strong></td>
<td><strong>(Leaf switches)</strong></td>
</tr>
<tr>
<td>VRF10</td>
<td>10.255.10.0/27</td>
</tr>
<tr>
<td>VRF11</td>
<td>10.255.11.0/27</td>
</tr>
<tr>
<td><strong>SVIs (interface vlan&hellip;)</strong></td>
<td><strong>10.10.<code>&lt;VLAN-ID&gt;</code>.0/24</strong></td>
</tr>
<tr>
<td>For example <code>interface VLAN11</code> has the IP address:</td>
<td>10.10.11.1</td>
</tr>
<tr>
<td><strong>MLAG Peer-link (interface vlan 4094)</strong></td>
<td><strong>(Leaf switches)</strong></td>
</tr>
<tr>
<td>DC1</td>
<td>10.255.1.64/27</td>
</tr>
<tr>
<td><strong>MLAG iBGP Peering (interface vlan 4093)</strong></td>
<td><strong>(Leaf switches)</strong></td>
</tr>
<tr>
<td>DC1</td>
<td>10.255.1.96/27</td>
</tr>
</tbody>
</table>
<h3 id="bgp-design">BGP Design<a class="headerlink" href="#bgp-design" title="Permanent link">&para;</a></h3>
<p>The following drawing shows the BGP Design used in this example. The orange dashed lines illustrate the eBGP point-to-point peerings used for the underlay, while the blue dotted lines illustrate the eBGP multi-hop peerings between Loopback0 interfaces used for the EVPN overlay. Finally, the green dashed lines illustrate the iBGP peerings between MLAG peers:</p>
<p><img alt="Figure: Arista BGP Design" src="images/single-dc-bgp.png" /></p>
<h3 id="basic-eos-config">Basic EOS config<a class="headerlink" href="#basic-eos-config" title="Permanent link">&para;</a></h3>
<p>Basic connectivity between the Ansible host and the switches must be established manually before Ansible can be used to push configuration. The following must be configured on all switches:</p>
<ul>
<li>A hostname configured purely for ease of understanding.</li>
<li>An IP enabled interface - in this example the dedicated out-of-band management interface is used.</li>
<li>A username and password with the proper access privileges.</li>
</ul>
<p>Below is the basic configuration file for <code>dc1-leaf1a</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>!<span class="w"> </span>ansible-avd-examples/single-dc-l3ls/switch-basic-configurations/dc1-leaf1a-basic-configuration.txt
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>!<span class="w"> </span>Basic<span class="w"> </span>EOS<span class="w"> </span>config
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>!
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>!<span class="w"> </span>Hostname<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>device
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>hostname<span class="w"> </span>dc1-leaf1a
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>!
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>!<span class="w"> </span>Configures<span class="w"> </span>username<span class="w"> </span>and<span class="w"> </span>password<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>ansible<span class="w"> </span>user
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>username<span class="w"> </span>ansible<span class="w"> </span>privilege<span class="w"> </span><span class="m">15</span><span class="w"> </span>role<span class="w"> </span>network-admin<span class="w"> </span>secret<span class="w"> </span>sha512<span class="w"> </span><span class="nv">$6$7</span>u4j1rkb3VELgcZE<span class="nv">$EJt2Qff8kd</span>/TapRoci0XaIZsL4tFzgq1YZBLD9c6f/knXzvcYY0NcMKndZeCv0T268knGKhOEwZAxqKjlMm920
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>!
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>!<span class="w"> </span>Defines<span class="w"> </span>the<span class="w"> </span>VRF<span class="w"> </span><span class="k">for</span><span class="w"> </span>MGMT
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>vrf<span class="w"> </span>instance<span class="w"> </span>MGMT
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>!
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>!<span class="w"> </span>Defines<span class="w"> </span>the<span class="w"> </span>settings<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>Management1<span class="w"> </span>interface<span class="w"> </span>through<span class="w"> </span>which<span class="w"> </span>Ansible<span class="w"> </span>reaches<span class="w"> </span>the<span class="w"> </span>device
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>interface<span class="w"> </span>Management1
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">   </span>description<span class="w"> </span>oob_management
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">   </span>no<span class="w"> </span>shutdown
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">   </span>vrf<span class="w"> </span>MGMT
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">   </span>!<span class="w"> </span>IP<span class="w"> </span>address<span class="w"> </span>-<span class="w"> </span>must<span class="w"> </span>be<span class="w"> </span><span class="nb">set</span><span class="w"> </span>uniquely<span class="w"> </span>per<span class="w"> </span>device
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">   </span>ip<span class="w"> </span>address<span class="w"> </span><span class="m">172</span>.16.1.101/24
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>!
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>!<span class="w"> </span>Static<span class="w"> </span>default<span class="w"> </span>route<span class="w"> </span><span class="k">for</span><span class="w"> </span>VRF<span class="w"> </span>MGMT
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>ip<span class="w"> </span>route<span class="w"> </span>vrf<span class="w"> </span>MGMT<span class="w"> </span><span class="m">0</span>.0.0.0/0<span class="w"> </span><span class="m">172</span>.16.1.1
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>!
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>!<span class="w"> </span>Enables<span class="w"> </span>API<span class="w"> </span>access<span class="w"> </span><span class="k">in</span><span class="w"> </span>VRF<span class="w"> </span>MGMT
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>management<span class="w"> </span>api<span class="w"> </span>http-commands
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">   </span>protocol<span class="w"> </span>https
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">   </span>no<span class="w"> </span>shutdown
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">   </span>!
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="w">   </span>vrf<span class="w"> </span>MGMT
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="w">      </span>no<span class="w"> </span>shutdown
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a>!
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a>end
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>!
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>!<span class="w"> </span>Save<span class="w"> </span>configuration<span class="w"> </span>to<span class="w"> </span>flash
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>copy<span class="w"> </span>running-config<span class="w"> </span>startup-config
</code></pre></div>
<p>The folder <code>single-dc-l3ls/switch-basic-configurations/</code> contains a file per device for the initial configuration.</p>
<h2 id="ansible-inventory-group-vars-and-naming-scheme">Ansible inventory, group vars and naming scheme<a class="headerlink" href="#ansible-inventory-group-vars-and-naming-scheme" title="Permanent link">&para;</a></h2>
<p>The following drawing shows a graphic overview of the Ansible inventory, group variables and naming scheme used in this example:</p>
<p><img alt="Figure: Ansible inventory and vars" src="images/single-dc-inventory-and-vars.png" /></p>
<p>Please note, the two servers <code>dc1-leaf1-server1</code> and <code>dc1-leaf2-server1</code> at the bottom <strong>are not</strong> configured by AVD, but the switch ports used to connect to the servers are.</p>
<p>Group names use uppercase and underscores:</p>
<ul>
<li>FABRIC</li>
<li>DC1</li>
<li>DC1_SPINES</li>
<li>DC1_L3_LEAVES</li>
<li>DC1_L2_LEAVES</li>
</ul>
<p>All hostnames use lowercase and dashes for example:</p>
<ul>
<li>dc1-spine1</li>
<li>dc1-leaf1a</li>
<li>dc1-leaf2c</li>
</ul>
<p>The drawing also shows the relationships between groups and their children:</p>
<ul>
<li>For example, <code>dc1-spine1</code> and <code>dc1-spine2</code> are both children of the group called <code>DC1_SPINES</code>.</li>
</ul>
<p>Additionally groups themselves can be children of another group for example:</p>
<ul>
<li><code>DC1_L3_LEAVES</code> is a group consisting of the groups <code>DC1_LEAF1</code> and <code>DC1_LEAF2</code></li>
<li><code>DC1_L3_LEAVES</code> is also a child of the group <code>DC1</code>.</li>
</ul>
<p>This naming convention makes it possible to easily extend anything, but as always, this can be changed based on your preferences. Just ensure that the names of all groups and hosts are unique.</p>
<h3 id="content-of-the-inventoryyml-file">Content of the inventory.yml file<a class="headerlink" href="#content-of-the-inventoryyml-file" title="Permanent link">&para;</a></h3>
<p>This section describes the full <code>ansible-avd-examples/single-dc-l3ls/inventory.yml</code> file used to represent the topology shown above.</p>
<p>It is important that the hostnames specified in the inventory exist either in DNS or in the hosts file on your Ansible host to allow successful name lookup and be able to reach the switches directly. A successful ping from the Ansible host to each inventory host allows to verify name resolution (e.g. <code>ping dc1-spine1</code>).</p>
<p>Alternatively, if there is no DNS available, or if devices need to be reached using a fully-qualified domain-name (FQDN), define <code>ansible_host</code> to be an IP address or FQDN for each device - see below for an example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>---
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>all:
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>  children:
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    FABRIC:
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>      children:
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>        DC1:
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>          children:
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>            DC1_SPINES:
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>              hosts:
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>                dc1-spine1:
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>                  ansible_host: 172.16.1.11
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>                dc1-spine2:
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>                  ansible_host: 172.16.1.12
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>            DC1_L3_LEAVES:
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>              hosts:
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>                dc1-leaf1a:
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>                  ansible_host: 172.16.1.101
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>                dc1-leaf1b:
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>                  ansible_host: 172.16.1.102
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>                dc1-leaf2a:
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>                  ansible_host: 172.16.1.103
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>                dc1-leaf2b:
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>                  ansible_host: 172.16.1.104
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>            DC1_L2_LEAVES:
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>              hosts:
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>                dc1-leaf1c:
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>                  ansible_host: 172.16.1.151
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>                dc1-leaf2c:
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>                  ansible_host: 172.16.1.152
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>        NETWORK_SERVICES:
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>          children:
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>            DC1_L3_LEAVES:
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>            DC1_L2_LEAVES:
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>        CONNECTED_ENDPOINTS:
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>          children:
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>            DC1_L3_LEAVES:
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a>            DC1_L2_LEAVES:
</code></pre></div>
<p>The above is what is included in this example, <em>purely</em> to make it as simple as possible to get started.
However, going forward please do not to carry over this practice to a production environment, where an inventory file for an identical topology should look as follows when using DNS:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>---
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>all:
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>  children:
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    FABRIC:
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>      children:
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        DC1:
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>          children:
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>            DC1_SPINES:
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>              hosts:
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>                dc1-spine1:
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>                dc1-spine2:
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>            DC1_L3_LEAVES:
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>              hosts:
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>                dc1-leaf1a:
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>                dc1-leaf1b:
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>                dc1-leaf2a:
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>                dc1-leaf2b:
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>            DC1_L2_LEAVES:
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>              hosts:
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>                dc1-leaf1c:
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>                dc1-leaf2c:
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>        NETWORK_SERVICES:
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>          children:
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>            DC1_L3_LEAVES:
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>            DC1_L2_LEAVES:
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>        CONNECTED_ENDPOINTS:
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>          children:
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>            DC1_L3_LEAVES:
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>            DC1_L2_LEAVES:
</code></pre></div>
<p>The <code>NETWORK_SERVICES</code> section does two things:</p>
<ol>
<li>It creates a group named &ldquo;NETWORK_SERVICES&rdquo;. Ansible variable resolution resolves this group name to the identically named group_vars file (<code>ansible-avd-examples/single-dc-l3ls/group_vars/NETWORK_SERVICES.yml</code>).</li>
<li>The contents of the file, which in this case are specifications of VRFs and VLANs, are then applied to the children of the group, in this case the two groups <code>DC1_L3_LEAVES</code> and <code>DC1_L2_LEAVES</code></li>
</ol>
<p>The <code>CONNECTED_ENDPOINTS</code> section also does two things:</p>
<ol>
<li>It creates a group named &ldquo;CONNECTED_ENDPOINTS&rdquo;. Ansible variable resolution resolves this group name to the identically named group_vars file (<code>ansible-avd-examples/single-dc-l3ls/group_vars/CONNECTED_ENDPOINTS.yml</code>).</li>
<li>The contents of the file, which in this case are specifications of connected endpoints (typically servers), are then applied to the children of the group, in this case the two groups <code>DC1_L3_LEAVES</code> and <code>DC1_L2_LEAVES</code></li>
</ol>
<h2 id="defining-device-types">Defining device types<a class="headerlink" href="#defining-device-types" title="Permanent link">&para;</a></h2>
<p>Since this example covers building a L3LS network, AVD must know about the device types, for example spines, L3 leaves, L2 leaves etc. The devices are already grouped in the inventory, so the device types are specified in the group variable files with the following names and content:</p>
<p><code>ansible-avd-examples/single-dc-l3ls/group_vars/DC1_SPINES.yml</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>---
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>type: spine
</code></pre></div>
<p><code>ansible-avd-examples/single-dc-l3ls/group_vars/DC1_L3_LEAVES.yml</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>---
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>type: l3leaf
</code></pre></div>
<p><code>ansible-avd-examples/single-dc-l3ls/group_vars/DC1_L2_LEAVES.yml</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>---
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>type: l2leaf
</code></pre></div>
<p>For example, this means that all switches that are children of the DC1_SPINES group defined in the inventory will be of the type <code>spine</code>.</p>
<h2 id="setting-fabric-wide-configuration-parameters">Setting fabric-wide configuration parameters<a class="headerlink" href="#setting-fabric-wide-configuration-parameters" title="Permanent link">&para;</a></h2>
<p>The <code>ansible-avd-examples/single-dc-l3ls/group_vars/FABRIC.yml</code> file defines generic settings that apply to all children of the <code>FABRIC</code> group as defined in the inventory described earlier.</p>
<p>The first section defines how the Ansible host connects to the devices:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>ansible_connection: ansible.netcommon.httpapi
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>ansible_network_os: arista.eos.eos
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>ansible_user: ansible
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>ansible_password: ansible
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>ansible_become: true
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>ansible_become_method: enable
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>ansible_httpapi_use_ssl: true
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>ansible_httpapi_validate_certs: false
</code></pre></div>
<ul>
<li>The Ansible host must use eAPI via HTTPS.</li>
<li>Network OS which in this case is Arista EOS.</li>
<li>The username/password combo.</li>
<li>How to escalate privileges to get write access.</li>
<li>Use SSL.</li>
<li>Do not validate SSL certificates.</li>
</ul>
<p>The next section specifies variables that generate configuration to be applied to all devices in the fabric:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>fabric_name: FABRIC
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>underlay_routing_protocol: EBGP
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>overlay_routing_protocol: EBGP
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>local_users:
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>  ansible:
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    privilege: 15
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>    role: network-admin
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>    sha512_password: $6$7u4j1rkb3VELgcZE$EJt2Qff8kd/TapRoci0XaIZsL4tFzgq1YZBLD9c6f/knXzvcYY0NcMKndZeCv0T268knGKhOEwZAxqKjlMm920
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>  admin:
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>    privilege: 15
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>    role: network-admin
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>    no_password: true
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>bgp_peer_groups:
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>  evpn_overlay_peers:
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>    password: Q4fqtbqcZ7oQuKfuWtNGRQ==
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>  ipv4_underlay_peers:
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>    password: 7x4B4rnJhZB438m9+BrBfQ==
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>  mlag_ipv4_underlay_peer:
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>    password: 4b21pAdCvWeAqpcKDFMdWw==
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>p2p_uplinks_mtu: 1500
</code></pre></div>
<ul>
<li>The name of the fabric for internal AVD use. This name <em>must</em> match the name of an Ansible Group (and therefore a corresponding group_vars file) covering all network devices.</li>
<li>Local users/passwords and their privilege levels. In this case the <code>ansible</code> user is set with the password <code>ansible</code> and an <code>admin</code> user is set with no password.</li>
<li>BGP peer groups and their passwords (all passwords are &ldquo;arista&rdquo;).</li>
<li>Point-to-point interface MTU, in this case it is set to 1500 since the example is using vEOS, but when using hardware this should be set to 9214 instead.</li>
</ul>
<h2 id="setting-device-specific-configuration-parameters">Setting device specific configuration parameters<a class="headerlink" href="#setting-device-specific-configuration-parameters" title="Permanent link">&para;</a></h2>
<p>The <code>ansible-avd-examples/single-dc-l3ls/group_vars/DC1.yml</code> file defines settings that apply to all children of the <code>DC1</code> group as defined in the inventory described earlier. This time the settings defined are no longer fabric-wide, but are limited to DC1. In this example with only a single data center this is of limited benefit, but it allows to scale the configuration to a scenario with multiple data centers in the future.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>---
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>mgmt_gateway: 172.16.1.1
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>spine:
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>  defaults:
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    platform: vEOS-lab
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    loopback_ipv4_pool: 10.255.0.0/27
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>    bgp_as: 65100
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>    bgp_defaults:
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>      - no bgp default ipv4-unicast
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>      - distance bgp 20 200 200
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>      - graceful-restart restart-time 300
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>      - graceful-restart
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>  nodes:
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>    dc1-spine1:
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>      id: 1
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>      mgmt_ip: 172.16.1.11/24
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>    dc1-spine2:
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>      id: 2
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>      mgmt_ip: 172.16.1.12/24
</code></pre></div>
<p>Initially the default gateway for the management interface of all devices in DC1 is defined.</p>
<p>The following section defines the spine layer:</p>
<ul>
<li>A number of default settings that apply to all nodes with the device type <code>spine</code>:<ul>
<li><code>platform</code> references default settings defined in AVD that are specific to certain switch platforms.</li>
<li><code>loopback_ipv4_pool</code> defines the IP scope from which AVD assigns IPv4 addresses for Loopback0.</li>
<li><code>bgp_as</code> defines the BGP AS number.</li>
<li><code>bgp_defaults</code> defines generic BGP settings.</li>
</ul>
</li>
<li><code>nodes</code> defines the actual spine switches, using the hostnames defined in the inventory.<ul>
<li><code>id</code> is used to calculate the various IP addresses, for example, the IPv4 address for the Loopback0 interface. In this case dc1-spine1 will get the IPv4 address 10.255.0.1/27 assigned to the Loopback0 interface.</li>
<li><code>mgmt_ip</code> defines the IPv4 address of the management interface. As stated earlier Ansible will perform name lookup when using the hostnames specified in the inventory, unless using the <code>ansible_host</code> option. However there is no automatic mechanism to grab the result of the name lookup and use that to generate the configuration of the actual management interface.</li>
</ul>
</li>
</ul>
<p>The next section covers the L3 leaf switches. Significantly more settings need to be set compared to the spine switches:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>l3leaf:
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>  defaults:
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    platform: vEOS-lab
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>    loopback_ipv4_pool: 10.255.0.0/27
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>    loopback_ipv4_offset: 2
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>    vtep_loopback_ipv4_pool: 10.255.1.0/27
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>    uplink_interfaces: [&#39;Ethernet1&#39;, &#39;Ethernet2&#39;]
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>    uplink_switches: [&#39;dc1-spine1&#39;, &#39;dc1-spine2&#39;]
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>    uplink_ipv4_pool: 10.255.255.0/26
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>    mlag_interfaces: [&#39;Ethernet3&#39;, &#39;Ethernet4&#39;]
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>    mlag_peer_ipv4_pool: 10.255.1.64/27
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>    mlag_peer_l3_ipv4_pool: 10.255.1.96/27
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>    bgp_defaults:
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>      - no bgp default ipv4-unicast
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>      - distance bgp 20 200 200
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>      - graceful-restart restart-time 300
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>      - graceful-restart
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>    virtual_router_mac_address: 00:1c:73:00:00:99
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>    spanning_tree_priority: 4096
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>    spanning_tree_mode: mstp
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>  node_groups:
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>    DC1_L3_LEAF1:
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>      bgp_as: 65101
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>      nodes:
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>        dc1-leaf1a:
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>          id: 1
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>          mgmt_ip: 172.16.1.101/24
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>          uplink_switch_interfaces:
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>            - Ethernet1
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a>            - Ethernet1
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a>        dc1-leaf1b:
<a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>          id: 2
<a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a>          mgmt_ip: 172.16.1.102/24
<a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a>          uplink_switch_interfaces:
<a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a>            - Ethernet2
<a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a>            - Ethernet2
<a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a>
<a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a>    DC1_L3_LEAF2:
<a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a>      bgp_as: 65102
<a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a>      nodes:
<a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a>        dc1-leaf2a:
<a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a>          id: 3
<a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a>          mgmt_ip: 172.16.1.103/24
<a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a>          uplink_switch_interfaces:
<a id="__codelineno-10-46" name="__codelineno-10-46" href="#__codelineno-10-46"></a>            - Ethernet3
<a id="__codelineno-10-47" name="__codelineno-10-47" href="#__codelineno-10-47"></a>            - Ethernet3
<a id="__codelineno-10-48" name="__codelineno-10-48" href="#__codelineno-10-48"></a>        dc1-leaf2b:
<a id="__codelineno-10-49" name="__codelineno-10-49" href="#__codelineno-10-49"></a>          id: 4
<a id="__codelineno-10-50" name="__codelineno-10-50" href="#__codelineno-10-50"></a>          mgmt_ip: 172.16.1.104/24
<a id="__codelineno-10-51" name="__codelineno-10-51" href="#__codelineno-10-51"></a>          uplink_switch_interfaces:
<a id="__codelineno-10-52" name="__codelineno-10-52" href="#__codelineno-10-52"></a>            - Ethernet4
<a id="__codelineno-10-53" name="__codelineno-10-53" href="#__codelineno-10-53"></a>            - Ethernet4
</code></pre></div>
<ul>
<li>Again a number of default settings are defined:<ul>
<li><code>platform</code> references default settings defined in AVD that are specific to certain switch platforms.</li>
<li><code>loopback_ipv4_pool</code> defines the IP scope from which AVD assigns IPv4 addresses for Loopback0. Please note that in this example, this IP pool is identical to the one used for the spine switches. To avoid assigning identical IP addresses for several devices, the option <code>loopback_ipv4_offset</code> is defined next.</li>
<li><code>loopback_ipv4_offset</code> offsets all assigned loopback IP addresses counting from the beginning of the IP scope. This is required when the same IP pool is used for two different node_types (like spine and l3leaf in this example) to avoid over-lapping IPs. In this case the offset is &ldquo;2&rdquo; because each spine switch uses one loopback address.</li>
<li><code>vtep_loopback_ipv4_pool</code> defines the IP scope from which AVD assigns IPv4 addresses for the VTEP (Loopback1).</li>
<li><code>uplink_interfaces</code> defines the interfaces used locally on the leaf switches.</li>
<li><code>uplink_switches</code> defines the uplink switches which in this case are dc1-spine1 and dc1-spine2. Note that the <code>uplink_interfaces</code> and <code>uplink_switches</code> are paired vertically.</li>
<li><code>uplink_ipv4_pool</code> defines the IP scope from which AVD assigns IPv4 addresses for the uplink interfaces that was just defined.</li>
<li><code>mlag_interfaces</code> defines the MLAG interfaces used on each leaf switch, in this case Ethernet3 and Ethernet4. These two interfaces will form PortChannel3 used for the MLAG peer link. Note that PortChannel3 is selected, since the first interface is Ethernet3.</li>
<li><code>mlag_peer_ipv4_pool</code> defines the IP scope from which AVD assigns IPv4 addresses for the MLAG peer link interface VLAN4094.</li>
<li><code>mlag_peer_l3_ipv4_pool</code> defines the IP scope from which AVD assigns IPv4 addresses for the iBGP peering established between the two leaf switches via the SVI/IRB interface VLAN4093.</li>
<li><code>virtual_router_mac_address</code> defines the MAC address used for the anycast gateway used on the various subnets. This is the MAC address that connected endpoints will learn when ARPing for their default gateway.</li>
<li><code>spanning_tree_priority</code> sets the spanning-tree priority. Since spanning-tree in a L3LS network is effectively only running locally on the switch, the same priority across all L3 leaf switches can be re-used.</li>
<li><code>spanning_tree_mode</code> defines the spanning-tree mode, in this case MSTP, which is the default. Other modes are supported should they be required, for example, for connectivity to legacy or third party vendor environments.</li>
</ul>
</li>
<li><code>node_groups</code> is used to define settings common to more than one node. For leaf switches, when exactly two nodes are part of a node group, AVD will by default automatically generate MLAG configuration.<ul>
<li><code>bgp_as</code> is defined just once since an MLAG pair shares a single BGP AS number.</li>
<li><code>uplink_switch_interfaces</code> defines the interfaces used on the uplink switches (Ethernet1 on dc1-spine1 and dc1-spine2 in this example). By defining which spine interfaces the leaf is connected to under the leaf switch settings, it makes addition and removal of leaf switches much easier. There is no need to add/remove any settings under the spine switch section, AVD takes care of that for you. This child device/parent device hierarchy also applies to L2 leaves and L3 leaves.</li>
</ul>
</li>
</ul>
<p>Finally more of the same, but this time for the L2 leaf switches:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>l2leaf:
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>  defaults:
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    platform: vEOS-lab
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    uplink_interfaces: [&#39;Ethernet1&#39;, &#39;Ethernet2&#39;]
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    spanning_tree_mode: mstp
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>  node_groups:
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>    DC1_L2_LEAF1:
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>      uplink_switches: [&#39;dc1-leaf1a&#39;, &#39;dc1-leaf1b&#39;]
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>      nodes:
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>        dc1-leaf1c:
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>          id: 1
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>          mgmt_ip: 172.16.1.151/24
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>          uplink_switch_interfaces:
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>            - Ethernet8
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>            - Ethernet8
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>    DC1_L2_LEAF2:
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>      uplink_switches: [&#39;dc1-leaf2a&#39;, &#39;dc1-leaf2b&#39;]
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>      nodes:
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>        dc1-leaf2c:
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>          id: 2
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>          mgmt_ip: 172.16.1.152/24
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>          uplink_switch_interfaces:
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>            - Ethernet8
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>            - Ethernet8
</code></pre></div>
<p>As should be clear, a L2 leaf switch is much simpler than a L3 switch, hence there are fewer settings to define.</p>
<h2 id="specifying-network-services-vrfs-and-vlans-in-the-evpnvxlan-fabric">Specifying network services (VRFs and VLANs) in the EVPN/VXLAN Fabric<a class="headerlink" href="#specifying-network-services-vrfs-and-vlans-in-the-evpnvxlan-fabric" title="Permanent link">&para;</a></h2>
<p>The <code>ansible-avd-examples/single-dc-l3ls/group_vars/NETWORK_SERVICES.yml</code> file is shown below.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>---
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>tenants:
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>  TENANT1:
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>    mac_vrf_vni_base: 10000
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>    vrfs:
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>      VRF10:
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>        vrf_vni: 10
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>        vtep_diagnostic:
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>          loopback: 10
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>          loopback_ip_range: 10.255.10.0/27
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>        svis:
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>          &quot;11&quot;:
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>            name: VRF10_VLAN11
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>            enabled: true
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>            ip_address_virtual: 10.10.11.1/24
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>          &quot;12&quot;:
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>            name: VRF10_VLAN12
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>            enabled: true
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>            ip_address_virtual: 10.10.12.1/24
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>      VRF11:
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>        vrf_vni: 11
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>        vtep_diagnostic:
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>          loopback: 11
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>          loopback_ip_range: 10.255.11.0/27
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>        svis:
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>          &quot;21&quot;:
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a>            name: VRF11_VLAN21
<a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a>            enabled: true
<a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a>            ip_address_virtual: 10.10.21.1/24
<a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a>          &quot;22&quot;:
<a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a>            name: VRF11_VLAN22
<a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a>            enabled: true
<a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a>            ip_address_virtual: 10.10.22.1/24
<a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a>
<a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a>    l2vlans:
<a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a>      &quot;3401&quot;:
<a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a>        name: L2_VLAN3401
<a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a>      &quot;3402&quot;:
<a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a>        name: L2_VLAN3402
</code></pre></div>
<p>All services in the entire fabric or in other words all VRFs and VLANs are defined here. This means that regardless of where a given VRF or VLAN must exist, its existence is defined in this file, but it does not indicate <strong><em>where</em></strong> in the fabric it exists. That was done at the bottom of the inventory file previously described in the <a href="#content-of-the-inventoryyml-file">Inventory</a> section.</p>
<p>AVD offers granular control of where Tenants and VLANs are configured using <code>tags</code> and <code>filter</code>. Those areas are not covered in this basic example.</p>
<p>A single tenant called <code>TENANT1</code> is specified. The first setting is the base number (<code>10000</code>) used to automatically generate the L2VNI numbers, <code>L2VNI = base number + VLAN-id</code>. For example, L2VNI for VLAN11 = 10000 + 11 = 10011.</p>
<p>Next, two VRFs are defined, each with two VLANs.
For example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>      VRF10:
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>        vrf_vni: 10
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>        vtep_diagnostic:
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>          loopback: 10
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>          loopback_ip_range: 10.255.10.0/27
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>        svis:
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>          &quot;11&quot;:
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>            name: VRF10_VLAN11
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>            enabled: true
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>            ip_address_virtual: 10.10.11.1/24
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>          &quot;12&quot;:
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>            name: VRF10_VLAN12
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>            enabled: true
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>            ip_address_virtual: 10.10.12.1/24
</code></pre></div>
<p>This defines <code>VRF10</code>, with a L3VNI of <code>10</code> and two VLANs (<code>VLAN11</code> and <code>VLAN12</code>).
Each VLAN has a name and a virtual IP address assigned, which will be used as the default gateway for that particular VLAN on all leaf switches where the VLAN is created.</p>
<p>This configuration is also defined under <code>VRF10</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>        vtep_diagnostic:
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>          loopback: 10
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>          loopback_ip_range: 10.255.10.0/27
</code></pre></div>
<p>This enables more user friendly diagnostics for troubleshooting purposes, by defining a specific loopback per VRF. This will create the following Arista EOS config, for example for dc1-leaf1a:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>interface<span class="w"> </span>Loopback10
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">   </span>description<span class="w"> </span>VRF10_VTEP_DIAGNOSTICS
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">   </span>no<span class="w"> </span>shutdown
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">   </span>vrf<span class="w"> </span>VRF10
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">   </span>ip<span class="w"> </span>address<span class="w"> </span><span class="m">10</span>.255.10.3/32
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>!
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>ip<span class="w"> </span>address<span class="w"> </span>virtual<span class="w"> </span>source-nat<span class="w"> </span>vrf<span class="w"> </span>VRF10<span class="w"> </span>address<span class="w"> </span><span class="m">10</span>.255.10.3
</code></pre></div>
<p>At the very bottom of the <code>NETWORK_SERVICES.yml</code> file two layer2-only VLANs (<code>VLAN3401</code> and <code>VLAN3402</code>) are defined. These VLANs are only bridged across the fabric, but never routed anywhere:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>    l2vlans:
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>      &quot;3401&quot;:
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>        name: L2_VLAN3401
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>      &quot;3402&quot;:
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>        name: L2_VLAN3402
</code></pre></div>
<h2 id="specifying-endpoint-connectivity-in-the-evpnvxlan-fabric">Specifying endpoint connectivity in the EVPN/VXLAN Fabric<a class="headerlink" href="#specifying-endpoint-connectivity-in-the-evpnvxlan-fabric" title="Permanent link">&para;</a></h2>
<p>After the previous section, all VRFs and VLANs across the fabric are now defined. The <code>ansible-avd-examples/single-dc-l3ls/group_vars/CONNECTED_ENDPOINTS.yml</code> file specifies the connectivity for all endpoints in the fabric (typically servers):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>---
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>servers:
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>  dc1-leaf1-server1:
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>    adapters:
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>    - type: server
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>      server_ports: [ PCI1, PCI2 ]
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>      switch_ports: [ Ethernet5, Ethernet5 ]
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>      switches: [ dc1-leaf1a, dc1-leaf1b ]
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>      vlans: 11-12,21-22
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>      native_vlan: 4092
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>      mode: trunk
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>      spanning_tree_portfast: edge
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>      port_channel:
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>        description: PortChannel dc1-leaf1-server1
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>        mode: active
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>    - type: ilo
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>      server_ports: [ iLO ]
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>      switch_ports: [ Ethernet5 ]
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>      switches: [ dc1-leaf1c ]
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>      vlans: 11
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>      mode: access
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>      spanning_tree_portfast: edge
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a>  dc1-leaf2-server1:
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a>    adapters:
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>    - type: server
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a>      server_ports: [ PCI1, PCI2 ]
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a>      switch_ports: [ Ethernet5, Ethernet5 ]
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a>      switches: [ dc1-leaf2a, dc1-leaf2b ]
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a>      vlans: 11-12,21-22
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a>      native_vlan: 4092
<a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a>      mode: trunk
<a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a>      spanning_tree_portfast: edge
<a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a>      port_channel:
<a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a>        description: PortChannel dc1-leaf2-server1
<a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a>        mode: active
<a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a>
<a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a>    - type: ilo
<a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a>      server_ports: [ iLO ]
<a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a>      switch_ports: [ Ethernet5 ]
<a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a>      switches: [ dc1-leaf2c ]
<a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a>      vlans: 11
<a id="__codelineno-17-44" name="__codelineno-17-44" href="#__codelineno-17-44"></a>      mode: access
<a id="__codelineno-17-45" name="__codelineno-17-45" href="#__codelineno-17-45"></a>      spanning_tree_portfast: edge
</code></pre></div>
<p>This defines the settings for the relevant switch ports to which the endpoints connect, in this case the two servers <code>dc1-leaf1-server1</code> and <code>dc1-leaf2-server1</code>.</p>
<p>As an example, here is the configuration for <code>dc1-leaf1-server1</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>  dc1-leaf1-server1:
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>    adapters:
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>    - type: server
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>      server_ports: [ PCI1, PCI2 ]
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>      switch_ports: [ Ethernet5, Ethernet5 ]
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>      switches: [ dc1-leaf1a, dc1-leaf1b ]
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>      vlans: 11-12,21-22
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>      native_vlan: 4092
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>      mode: trunk
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>      spanning_tree_portfast: edge
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>      port_channel:
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>        description: PortChannel dc1-leaf1-server1
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>        mode: active
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>    - type: ilo
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>      server_ports: [ iLO ]
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>      switch_ports: [ Ethernet5 ]
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>      switches: [ dc1-leaf1c ]
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>      vlans: 11
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>      mode: access
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>      spanning_tree_portfast: edge
</code></pre></div>
<ul>
<li>The relevant <code>adapters</code> are defined:<ul>
<li><code>type</code> set to <code>server</code> and <code>ilo</code> is purely for documentation and readability purposes. It has no operational significance.</li>
<li><code>server_ports</code> are defined for use in the interface descriptions on the switch. This does not configure anything on the server.</li>
<li><code>switch_ports</code> defines the interfaces used in the switches. In this example the server is dual-connected to Ethernet5 and Ethernet5. These two ports exist on switch dc1-leaf1a and dc1-leaf1b defined in the following line.</li>
<li><code>switches</code> defines the switches used, in this case dc1-leaf1a and dc1-leaf1b. Note that the <code>server_ports</code>, <code>switch_ports</code> and <code>switches</code> definitions are paired vertically.</li>
<li><code>vlans</code> defines which VLANs are allowed on the switch_ports, in this case it is two ranges, VLAN11-12 and VLAN21-22 for the dual-attached server ports and VLAN11 for the iLO port.</li>
<li><code>native_vlan</code> specifies the native VLAN when the switch port mode is set to trunk.</li>
<li><code>mode</code> is set to trunk for the dual-attached server ports and access for the iLO port.</li>
<li><code>spanning_tree_portfast</code> defines whether the switch port should be a spanning-tree edge port or a network port.</li>
<li><code>port-channel</code> defines the description and mode for the port-channel.</li>
</ul>
</li>
</ul>
<h2 id="the-playbook">The playbook<a class="headerlink" href="#the-playbook" title="Permanent link">&para;</a></h2>
<p>In this example, the playbook looks like the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>- name: Run AVD
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>  hosts: FABRIC
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>  gather_facts: false
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>  tasks:
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>    - name: generate intended variables
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>      import_role:
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>        name: arista.avd.eos_designs
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>    - name: generate device intended config and documentation
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>      import_role:
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>        name: arista.avd.eos_cli_config_gen
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>    - name: deploy configuration to device
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>      import_role:
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>         name: arista.avd.eos_config_deploy_eapi
</code></pre></div>
<p>The name of the playbook is set along with the scope of the playbook, which in this example is the entire <code>FABRIC</code>. This is a group name defined in the inventory, hence if the playbook should only apply to a subset of devices, it can be changed here.</p>
<p>This playbook has three tasks that use three roles:</p>
<ul>
<li><code>generate intended variables</code> uses the role <code>arista.avd.eos_designs</code>, which generates structured configuration for each device. This structured configuration can be found in the <code>ansible-avd-examples/single-dc-l3ls/intended/structured_configs</code> folder.</li>
<li><code>generate device intended config and documentation</code> uses the role <code>arista.avd.eos_cli_config_gen</code>, which generates the actual Arista EOS CLI configurations found in the <code>ansible-avd-examples/single-dc-l3ls/intended/configs</code> folder, along with the device specific and fabric wide documentation found in the <code>ansible-avd-examples/single-dc-l3ls/documentation/</code> folder. It relies on the structured configuration generated by <code>arista.avd.eos_designs</code>.</li>
<li>Finally <code>deploy configuration to device</code> uses the role <code>arista.avd.eos_config_deploy_eapi</code> that pushes the generated configuration to the devices in scope.</li>
</ul>
<h3 id="testing-avd-output-without-a-lab">Testing AVD output without a lab<a class="headerlink" href="#testing-avd-output-without-a-lab" title="Permanent link">&para;</a></h3>
<p>To use this example without a lab, the playbook can be modified as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>- name: Run AVD
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>  hosts: FABRIC
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>  gather_facts: false
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>  tasks:
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>    - name: generate intended variables
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>      import_role:
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>        name: arista.avd.eos_designs
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>    - name: generate device intended config and documentation
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>      import_role:
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>        name: arista.avd.eos_cli_config_gen
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>    # - name: deploy configuration to device
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>    #   import_role:
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>    #      name: arista.avd.eos_config_deploy_eapi
</code></pre></div>
<p>By simply commenting out (or deleting) the third and last task definition, the playbook will generate all of the output (variables, configurations, documentation), but will not attempt to communicate with any devices.</p>
<p>Please look through the folders and files described above to learn more about the output generated by AVD.</p>
<h3 id="executing-the-playbook">Executing the playbook<a class="headerlink" href="#executing-the-playbook" title="Permanent link">&para;</a></h3>
<p>The execution of the playbook should produce the following output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>user@ubuntu:~/Documents/git_projects/ansible-avd-examples/single-dc-l3ls$<span class="w"> </span>ansible-playbook<span class="w"> </span>playbook.yml
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>PLAY<span class="w"> </span><span class="o">[</span>Run<span class="w"> </span>AVD<span class="o">]</span><span class="w"> </span>*****************************************************************************************************************************************************************************
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>TASK<span class="w"> </span><span class="o">[</span>arista.avd.eos_designs<span class="w"> </span>:<span class="w"> </span>Collection<span class="w"> </span>arista.avd<span class="w"> </span>version<span class="w"> </span><span class="m">3</span>.5.0<span class="w"> </span>loaded<span class="w"> </span>from<span class="w"> </span>/home/user/.ansible/collections/ansible_collections<span class="o">]</span><span class="w"> </span>******************************************************
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>ok:<span class="w"> </span><span class="o">[</span>dc1-leaf1a<span class="o">]</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>TASK<span class="w"> </span><span class="o">[</span>arista.avd.eos_designs<span class="w"> </span>:<span class="w"> </span>Create<span class="w"> </span>required<span class="w"> </span>output<span class="w"> </span>directories<span class="w"> </span><span class="k">if</span><span class="w"> </span>not<span class="w"> </span>present<span class="o">]</span><span class="w"> </span>**********************************************************************************************************
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>ok:<span class="w"> </span><span class="o">[</span>dc1-leaf1a<span class="w"> </span>-&gt;<span class="w"> </span>localhost<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">(</span><span class="nv">item</span><span class="o">=</span>/home/user/Documents/git_projects/ansible-avd-examples/single-dc-l3ls/intended/structured_configs<span class="o">)</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>ok:<span class="w"> </span><span class="o">[</span>dc1-leaf1a<span class="w"> </span>-&gt;<span class="w"> </span>localhost<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">(</span><span class="nv">item</span><span class="o">=</span>/home/user/Documents/git_projects/ansible-avd-examples/single-dc-l3ls/documentation/fabric<span class="o">)</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="o">(</span>...<span class="o">)</span>
</code></pre></div>
<p>If similar output is not shown, make sure:</p>
<ol>
<li>The documented <a href="../../docs/installation/requirements.html">requirements</a> are met.</li>
<li>The latest <code>arista.avd</code> collection is installed.</li>
</ol>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="evpn-not-working">EVPN not working<a class="headerlink" href="#evpn-not-working" title="Permanent link">&para;</a></h3>
<p>If after doing the following steps:</p>
<ol>
<li>Manually copy/paste the switch-basic-configuration to the devices.</li>
<li>Run the playbook and push the generated configuration to the fabric.</li>
<li>Login to a leaf device, for example, dc1-leaf1a and run the command <code>show bgp evpn summary</code> to view EVPN routes.</li>
</ol>
<p>The following error message is shown:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>dc1-leaf1a#show<span class="w"> </span>bgp<span class="w"> </span>evpn<span class="w"> </span>summ
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>%<span class="w"> </span>Not<span class="w"> </span>supported
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>dc1-leaf1a#
</code></pre></div>
<p>This is caused by AVD pushing the configuration line <code>service routing protocols model multi-agent</code>, which enables the multi-agent routing process supporting EVPN.
This change <em>requires</em> a reboot of the device.</p>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">August 10, 2022</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2019 - 2022 Arista Networks
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/aristanetworks/ansible-avd" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.arista.com" target="_blank" rel="noopener" title="www.arista.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M352 256c0 22.2-1.2 43.6-3.3 64H163.3c-2.2-20.4-3.3-41.8-3.3-64s1.2-43.6 3.3-64h185.4c2.2 20.4 3.3 41.8 3.3 64zm28.8-64h123.1c5.3 20.5 8.1 41.9 8.1 64s-2.8 43.5-8.1 64H380.8c2.1-20.6 3.2-42 3.2-64s-1.1-43.4-3.2-64zm112.6-32H376.7c-10-63.9-29.8-117.4-55.3-151.6 78.3 20.7 142 77.5 171.9 151.6zm-149.1 0H167.7c6.1-36.4 15.5-68.6 27-94.7 10.5-23.6 22.2-40.7 33.5-51.5C239.4 3.2 248.7 0 256 0s16.6 3.2 27.8 13.8c11.3 10.8 23 27.9 33.5 51.5 11.6 26 21 58.2 27 94.7zm-209 0H18.6c30-74.1 93.6-130.9 172-151.6-25.5 34.2-45.3 87.7-55.3 151.6zM8.1 192h123.1c-2.1 20.6-3.2 42-3.2 64s1.1 43.4 3.2 64H8.1C2.8 299.5 0 278.1 0 256s2.8-43.5 8.1-64zm186.6 254.6c-11.6-26-20.9-58.2-27-94.6h176.6c-6.1 36.4-15.5 68.6-27 94.6-10.5 23.6-22.2 40.7-33.5 51.5-11.2 10.7-20.5 13.9-27.8 13.9s-16.6-3.2-27.8-13.8c-11.3-10.8-23-27.9-33.5-51.5zM135.3 352c10 63.9 29.8 117.4 55.3 151.6-78.4-20.7-142-77.5-172-151.6h116.7zm358.1 0c-30 74.1-93.6 130.9-171.9 151.6 25.5-34.2 45.2-87.7 55.3-151.6h116.6z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.top", "search.highlight", "header.autohide", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.2a6f1dda.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../docs/stylesheets/tables.js"></script>
      
    
  </body>
</html>