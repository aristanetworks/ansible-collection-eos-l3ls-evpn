---
# This workflow is required to experiment with container images on forks
# it will NEVER run on aristanetworks/avd and requires following env variables:
#     DEBUG_CONTAINER_ACTIONS = true
# The workflow supposed to be the exact replica of container_build_universal.yml in a stable state
# but diff is allowed to support a longer experimental setup across different forks
name: Build universal on forks

"on":
  push:
    branches: [ '**' ]
    paths:
      - containers/universal/**
      - .github/workflows/container_build_template.yml
      - .github/workflows/build_universal_on_forks.yml
      - ansible_collections/arista/avd/**
  workflow_dispatch:
    branches: [ '**' ]
  release:
    types: [published]

jobs:
  build_universal_container:
    if: github.repository != 'aristanetworks/avd' && ${{ vars.DEBUG_CONTAINER_ACTIONS }} == "true"
    uses: ./.github/workflows/container_build_template.yml
    strategy:
      matrix:
        container_name: [universal]
        python_version: ["3.10", "3.11", "3.12", "3.13"]
        include:
          - python_version: "3.11"
            container_tags: latest
    with:
      container_name: ${{ matrix.container_name }}
      python_version: ${{ matrix.python_version }}
      container_tags: ${{ matrix.container_tags }}
