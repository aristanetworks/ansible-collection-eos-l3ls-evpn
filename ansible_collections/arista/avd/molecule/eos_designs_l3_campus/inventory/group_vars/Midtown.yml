---
fabric_name: Midtown

# Define underlay and overlay routing protocol to be used
underlay_routing_protocol: ebgp
overlay_routing_protocol: none

# Default gateway used for the management interface
mgmt_gateway: 172.16.1.1

# Spine switch group
spine:
  defaults:
    # Set the relevant platform as each platform has different default values in Ansible AVD
    platform: 7050SX3
    # Pool of IPv4 addresses to configure interface Loopback0 used for BGP EVPN sessions
    loopback_ipv4_pool: 10.255.0.0/27
    # ASN to be used by BGP
    bgp_as: 65100
    # BGP configuration for fine tuning
    bgp_defaults:
      - update wait-for-convergence
      - update wait-install
      - no bgp default ipv4-unicast
      - distance bgp 20 200 200
      - graceful-restart restart-time 300
      - graceful-restart

  nodes:
    - name: mtwn-spine1
      id: 1
      mgmt_ip: 172.16.1.11/24

    - name: mtwn-spine2
      id: 2
      mgmt_ip: 172.16.1.12/24

# L3 Leaf switch group
l3leaf:
  defaults:
    # Set the relevant platform as each platform has different default values in Ansible AVD
    platform: 720XP
    # Pool of IPv4 addresses to configure interface Loopback0 used for BGP EVPN sessions
    loopback_ipv4_pool: 10.255.0.0/27
    # Offset all assigned loopback IP addresses.
    loopback_ipv4_offset: 2
    # Disable role as vtep
    vtep: false
    # Definition of pool of IPs to be used in P2P links
    uplink_ipv4_pool: 10.255.255.0/24
    # MLAG Peer link physical interface definition
    mlag_interfaces: ['Ethernet49', 'Ethernet50']
    # Definition of pool of IPs to be used for MLAG peer-link connectivity
    mlag_peer_ipv4_pool: 10.255.1.64/27
    # iBGP Peering between MLAG peers
    mlag_peer_l3_ipv4_pool: 10.255.1.96/27
    bgp_defaults:
      - update wait-install
      - no bgp default ipv4-unicast
      - distance bgp 20 200 200
      - graceful-restart restart-time 300
      - graceful-restart
    # Virtual router mac for VNIs assigned to Leaf switches in format xx:xx:xx:xx:xx:xx
    virtual_router_mac_address: 00:1c:73:00:00:99
    spanning_tree_priority: 4096
    spanning_tree_mode: mstp

  # If two nodes (and only two) are in the same node_group, they will automatically form an MLAG pair
  node_groups:
    - group: MTWN_L3_FL1
      bgp_as: 65101
      uplink_interfaces: ['Ethernet51', 'Ethernet52']
      uplink_switches: ['mtwn-spine1', 'mtwn-spine2']
      nodes:
        - name: mtwn-fl1-lfa
          id: 1
          uplink_switch_interfaces: ['Ethernet1', 'Ethernet1']
        - name: mtwn-fl1-lfb
          id: 2
          uplink_switch_interfaces: ['Ethernet2', 'Ethernet2']

    - group: MTWN_L3_FL2
      bgp_as: 65102
      uplink_interfaces: ['Ethernet51', 'Ethernet52']
      uplink_switches: ['mtwn-spine1', 'mtwn-spine2']
      nodes:
        - name: mtwn-fl2-lfa
          id: 3
          # uplink_interfaces: ['Ethernet51']
          # uplink_switches: ['mtwn-spine1']
          # uplink_switch_interfaces: ['Ethernet3']
          uplink_switch_interfaces: ['Ethernet3', 'Ethernet3']
        - name: mtwn-fl2-lfb
          id: 4
          # uplink_interfaces: ['Ethernet51']
          # uplink_switches: ['mtwn-spine2']
          # uplink_switch_interfaces: ['Ethernet3']
          uplink_switch_interfaces: ['Ethernet4', 'Ethernet4']

    - group: MTWN_L3_FL3
      bgp_as: 65103
      nodes:
        - name: mtwn-fl3-lfa
          id: 5
          uplink_switch_interfaces: ['Ethernet5', 'Ethernet5']

# L2 Leaf switch group
l2leaf:
  defaults:
    platform: 720XP
    uplink_interfaces: ['Ethernet49', 'Ethernet50']
    mlag_interfaces: ['Ethernet51', 'Ethernet52']
    mlag_peer_ipv4_pool: 10.255.1.96/27
    spanning_tree_mode: mstp

  node_groups:
    - group: MTWN_L2_FL1-M12
      uplink_switches: ['mtwn-fl1-lfa', 'mtwn-fl1-lfb']
      nodes:
        - name: mtwn-fl1-m1
          id: 1
          uplink_switch_interfaces: ['Ethernet53', 'Ethernet53']
        - name: mtwn-fl1-m2
          id: 2
          mgmt_ip: 172.16.1.151/24
          uplink_switch_interfaces: ['Ethernet54', 'Ethernet54']

    - group: MTWN_L2_FL1-M34
      uplink_switches: ['mtwn-fl1-m1', 'mtwn-fl1-m2']
      nodes:
        - name: mtwn-fl1-m3
          id: 3
          uplink_switch_interfaces: ['Ethernet53', 'Ethernet53']
        - name: mtwn-fl1-m4
          id: 4
          mgmt_ip: 172.16.1.151/24
          uplink_switch_interfaces: ['Ethernet54', 'Ethernet54']

    - group: MTWN_L2_FL1-M56
      nodes:
        - name: mtwn-fl1-m5
          id: 5
          uplink_interfaces: ['Ethernet49']
          uplink_switches: ['mtwn-fl1-m3']
          uplink_switch_interfaces: ['Ethernet53']
        - name: mtwn-fl1-m6
          id: 6
          uplink_interfaces: []
          uplink_switches: []
          uplink_switch_interfaces: []

    - group: MTWN_L2_FL1-M7
      nodes:
        - name: mtwn-fl1-m7
          id: 7
          uplink_interfaces: ['Ethernet49']
          uplink_switches: ['mtwn-fl1-m6']
          uplink_switch_interfaces: ['Ethernet53']

    - group: MTWN_L2_FL2-M1
      nodes:
        - name: mtwn-fl2-m1
          id: 8
          uplink_interfaces: ['Ethernet49']
          uplink_switches: ['mtwn-fl2-lfa']
          uplink_switch_interfaces: ['Ethernet53']

    - group: MTWN_L2_FL2-M2
      nodes:
        - name: mtwn-fl2-m2
          id: 9
          uplink_interfaces: ['Ethernet49']
          uplink_switches: ['mtwn-fl2-lfb']
          uplink_switch_interfaces: ['Ethernet53']

    - group: MTWN_L2_FL3-M1
      nodes:
        - name: mtwn-fl3-m1
          id: 10
          uplink_interfaces: ['Ethernet49']
          uplink_switches: ['mtwn-fl3-lfa']
          uplink_switch_interfaces: ['Ethernet53']
