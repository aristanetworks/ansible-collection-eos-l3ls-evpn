---
- name: Converge
  hosts: FABRIC
  gather_facts: false
  connection: local
  vars:
    root_dir: '{{ playbook_dir }}'
    cvp_address: "{{ lookup('ansible.builtin.env', 'CVP_ADDRESS', default='None') }}"
  tasks:
    - name: Generate intended variables
      delegate_to: 127.0.0.1
      ansible.builtin.import_role:
        name: arista.avd.eos_designs

    - name: Apply tags in CloudVision
      ansible.builtin.import_role:
        name: arista.avd.cloudvision
      delegate_to: cv_server
      when:
        - cvp_address != "None"
