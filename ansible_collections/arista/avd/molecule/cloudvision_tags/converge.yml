---
- name: Converge
  hosts: FABRIC
  gather_facts: false
  connection: local
  vars:
    root_dir: '{{ playbook_dir }}'
    CVP_ADDRESS: "{{ lookup('ansible.builtin.env', 'CVP_ADDRESS', default=None) }}"
  tasks:
    - name: Generate intended variables
      delegate_to: 127.0.0.1
      ansible.builtin.import_role:
        name: arista.avd.eos_designs

    - name: Apply tags in CloudVision
      ansible.builtin.import_role:
        name: arista.avd.cloudvision
      vars:
        cvp_node: cv_server
      when:
        - CVP_ADDRESS != "None"
