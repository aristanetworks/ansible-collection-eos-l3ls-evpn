{# eos - ip nat #}
{% if ip_nat is arista.avd.defined %}
!
{%     if ip_nat.translation.address_selection.any | arista.avd.default(false) %}
ip nat translation address selection any
{%     endif %}
{%     if ip_nat.translation.address_selection.hash_field_source_ip | arista.avd.default(false) %}
ip nat translation address selection hash field source-ip
{%     endif %}
{%     for timeout in ip_nat.translation.timeouts | arista.avd.default([]) %}
ip nat translation {{ timeout.protocol }}-timeout {{ timeout.timeout }}
{%     endfor %}
{%     if ip_nat.translation.max_entries.limit is arista.avd.defined %}
ip nat translation max-entries {{ ip_nat.translation.max_entries.limit }}
{%     endif %}
{%     if ip_nat.translation.low_mark.percentage is arista.avd.defined %}
ip nat translation low-mark {{ ip_nat.translation.low_mark.percentage }}
{%     endif %}
{%     if ip_nat.translation.max_entries.host_limit is arista.avd.defined %}
ip nat translation max-entries {{ ip_nat.translation.max_entries.host_limit }} host
{%     endif %}
{%     if ip_nat.translation.low_mark.host_percentage is arista.avd.defined %}
ip nat translation low-mark {{ ip_nat.translation.low_mark.host_percentage }} host
{%     endif %}
{%     for ip_limit in ip_nat.translation.max_entries.ip_limits | arista.avd.default([]) %}
ip nat translation max-entries {{ ip_limit.limit }} {{ ip_limit.ip }}
{%     endfor %}
{%     if ip_nat.kernel_buffer_size is arista.avd.defined %}
ip nat kernel buffer size {{ ip_nat.kernel_buffer_size }}
{%     endif %}
{%     for pool in ip_nat.pools | arista.avd.default([]) %}
{%         if pool.name is arista.avd.defined and pool.prefix_length is arista.avd.defined %}
ip nat pool {{ pool.name }} prefix-length {{ pool.prefix_length }}
{%             for range in pool.ranges | arista.avd.default([]) %}
{%                 set range_cli = 'range ' ~ range.first_ip ~ ' ' ~ range.last_ip %}
{%                 if range.first_port is arista.avd.defined and range.last_port is arista.avd.defined %}
{%                     set range_cli = range_cli ~ ' ' ~ range.first_port ~ ' ' ~ range.last_port %}
{%                 endif %}
   {{ range_cli }}
{%             endfor %}
{%             if pool.utilization_log_threshold is arista.avd.defined %}
   utilization threshold {{ pool.utilization_log_threshold }} action log
{%             endif %}
{%         endif %}
{%     endfor %}
{%     if ip_nat.synchronization is arista.avd.defined %}
ip nat synchronization
{%         if ip_nat.synchronization.description is arista.avd.defined %}
   description {{ ip_nat.synchronization.description }}
{%         endif %}
{%         if ip_nat.synchronization.expiry_interval is arista.avd.defined %}
   expiry-interval {{ ip_nat.synchronization.expiry_interval }}
{%         endif %}
{%         if ip_nat.synchronization.shutdown | arista.avd.default(false) %}
   shutdown
{%         endif %}
{%         if ip_nat.synchronization.peer_address is arista.avd.defined %}
   peer-address {{ ip_nat.synchronization.peer_address }}
{%         endif %}
{%         if ip_nat.synchronization.local_interface is arista.avd.defined %}
   local-interface {{ ip_nat.synchronization.local_interface }}
{%         endif %}
{%         if ip_nat.synchronization.port_range is arista.avd.defined %}
{%             if ip_nat.synchronization.port_range.first_port is arista.avd.defined and
                       ip_nat.synchronization.port_range.last_port is arista.avd.defined %}
   port-range {{ ip_nat.synchronization.port_range.first_port }} {{ ip_nat.synchronization.port_range.last_port }}
{%             endif %}
{%             if ip_nat.synchronization.port_range.split_disabled | arista.avd.default(false)  %}
   port-range split disabled
{%             endif %}
{%         endif %}
{%     endif %}
{% endif %}
