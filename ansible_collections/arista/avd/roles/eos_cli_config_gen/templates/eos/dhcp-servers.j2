{#
 Copyright (c) 2023 Arista Networks, Inc.
 Use of this source code is governed by the Apache License 2.0
 that can be found in the LICENSE file.
#}
{# eos - dhcp servers #}
{% if dhcp_servers is arista.avd.defined %}
{%     for dhcp_server in dhcp_servers | arista.avd.natural_sort(dhcp_sever.vrf | arista.avd.default("default")) %}
{%         set server_cli = "dhcp server" %}
{%         if dhcp_server.vrf is arista.avd.defined %}
{%             set server_cli = server_cli ~ " vrf " ~ dhcp_server.vrf %}
{%         endif %}
!
{{ server_cli }}
{%         if dhcp_server.dns_domain_name_ipv4 is arista.avd.defined %}
   dns domain name ipv4 {{ dhcp_server.dns_domain_name_ipv4 }}
{%         endif %}
{%         if dhcp_server.dns_domain_name_ipv6 is arista.avd.defined %}
   dns domain name ipv6 {{ dhcp_server.dns_domain_name_ipv6 }}
{%         endif %}
{%         for subnet in dhcp_server.subnets | arista.avd.natural_sort %}
   !
   subnet {{ subnet.subnet }}
{%             for range in subnet.ranges | arista.avd.natural_sort("end") | arista.avd.natural_sort("start") %}
      !
      range {{ range.start }} {{ range.end }}
{%             endfor %}
{%             if subnet.name is arista.avd.defined %}
      name {{ subnet.name }}
{%             endif %}
{%             if subnet.dns_servers is arista.avd.defined %}
      dns server {{ subnet.dns_servers | join(" ") }}
{%             endif %}
{%             if subnet.lease_time is arista.avd.defined %}
      lease time {{ subnet.lease_time.days }} days {{ subnet.lease_time.hours }} hours {{ subnet.lease_time.minutes }} minutes
{%             endif %}
{%             if subnet.default_gateway is arista.avd.defined %}
      default-gateway {{ subnet.default_gateway }}
{%             endif %}
{%         endfor %}
{%         if dhcp_server.disabled | arista.avd.default(false) is true %}
   disabled
{%         endif %}
{%         for option in dhcp_server.ipv4_vendor_options | arista.avd.natural_sort("vendor_id") %}
   !
   vendor-option ipv4 {{ option.vendor_id }}
{%             for sub_option in option.sub_options | arista.avd.natural_sort %}
{%                 if sub_option.type == "string" %}
      sub-option {{ sub_option.number }} type {{ sub_option.type }} data "{{ sub_option.data }}"
{%                 else %}
      sub-option {{ sub_option.number }} type {{ sub_option.type }} data {{ sub_option.data }}
{%                 endif %}
{%             endfor %}
{%         endfor %}
{%     endfor %}
{% endif %}
