# Copyright (c) 2023 Arista Networks, Inc.
# Use of this source code is governed by the Apache License 2.0
# that can be found in the LICENSE file.
# yaml-language-server: $schema=../../../../plugins/plugin_utils/schema/avd_meta_schema.json
# Line above is used by RedHat's YAML Schema vscode extension
# Use Ctrl + Space to get suggestions for every field. Autocomplete will pop up after typing 2 letters.
type: dict
keys:
  cv_settings:
    documentation_options:
      table: cloudvision-settings
    type: dict
    description: |-
      Settings for configuring CloudVision telemetry streaming and provisioning.

      `cv_settings` replaces the following deprecated keys, which are ignored when `cv_settings` is set:
      - `cvp_ingestauth_key`
      - `cvp_instance_ip`
      - `cvp_instance_ips`
      - `cvp_token_file`
      - `terminattr_disable_aaa`
      - `terminattr_ingestexclude`
      - `terminattr_ingestgrpcurl_port`
      - `terminattr_smashexcludes`
    keys:
      cvaas_clusters:
        type: list
        description: CloudVision as a Service clusters.
        primary_key: name
        items:
          type: dict
          keys:
            name:
              type: str
              description: |-
                Cluster Name.
                Only used when configuring multiple clusters.
            server:
              type: str
              required: true
              pattern: "^[a-z1-9\\.-]+\\.arista\\.io"
              description: CVaaS Server name like 'www.arista.io' or 'www.cv-prod-euwest-2.arista.io'.
            vrf:
              type: str
              required: true
              convert_types:
                - int
              description: |-
                The VRF used to connect to CloudVision.
                - `use_mgmt_interface_vrf` will use VRF set with `mgmt_interface_vrf`.
                  An error will be raised if `mgmt_ip` or `ipv6_mgmt_ip` are not configured for the device.
                - `use_inband_mgmt_vrf` will use the VRF set with `inband_mgmt_vrf`.
                  An error will be raised if inband management is not configured for the device.
                - Any other string will be used directly as the VRF name.
            token_file:
              type: str
              description: |-
                Path to the onboarding token used for certificate based authentication.
                The path is on the EOS device and the token file must be copied to the device first.
              default: "/tmp/cv-onboarding-token"
      onprem_clusters:
        type: list
        description: On-premise CloudVision clusters.
        primary_key: name
        items:
          type: dict
          description: |-
            Unless `key` is set, TerminAttr will be configured with certificate based authentication.
            The default token path is '/tmp/token', and the token must be copied to the device first.
          keys:
            name:
              type: str
              description: |-
                Cluster Name.
                Only used when configuring multiple clusters.
            servers:
              type: list
              required: true
              min_length: 1
              max_length: 3
              primary_key: name
              description: CloudVision servers that makes up one cluster.
              items:
                type: dict
                keys:
                  name:
                    type: str
                    description: Server FQDN or IP address.
                  port:
                    type: int
                    convert_types:
                      - str
                    default: 9910
            vrf:
              type: str
              required: true
              convert_types:
                - int
              description: |-
                The VRF used to connect to CloudVision.
                - `use_mgmt_interface_vrf` will use VRF set with `mgmt_interface_vrf`.
                  An error will be raised if `mgmt_ip` or `ipv6_mgmt_ip` are not configured for the device.
                - `use_inband_mgmt_vrf` will use the VRF set with `inband_mgmt_vrf`.
                  An error will be raised if inband management is not configured for the device.
                - Any other string will be used directly as the VRF name.
            key:
              type: str
              convert_types:
                - int
              description: |-
                Key-based authentication is deprecated in CloudVision and is not supported starting from CloudVision 2023.1.0.
            token_file:
              type: str
              description: |-
                Path to the onboarding token used for certificate based authentication.
                The path is on the EOS device and the token file must be copied to the device first.
              default: "/tmp/token"
      terminattr_ingestexclude:
        type: str
        description: Exclude paths from Sysdb on the ingest side.
        default: "/Sysdb/cell/1/agent,/Sysdb/cell/2/agent"
      terminattr_smashexcludes:
        type: str
        description: Exclude paths from the shared memory table.
        default: "ale,flexCounter,hardware,kni,pulse,strata"
      terminattr_disable_aaa:
        type: bool
        description: |-
          Disable AAA authorization and accounting.
          When setting this flag, all commands pushed from CloudVision are applied directly to the CLI without authorization
        default: False
