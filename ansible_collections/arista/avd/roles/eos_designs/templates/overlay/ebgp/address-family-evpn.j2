{# j2lint: disable=V1 #}
  address_family_evpn:
    peer_groups:
      {{ bgp_peer_groups.EVPN_OVERLAY_PEERS.name | arista.avd.default("EVPN-OVERLAY-PEERS") }}:
        activate: true
{% if switch.evpn_gateway is arista.avd.defined(true) %}
      {{ bgp_peer_groups.evpn_overlay_core.name | arista.avd.default("EVPN-OVERLAY-CORE") }}:
        domain_remote: true
        activate: true
{%     if switch.evpn_gateway_evpn_l3 is arista.avd.defined(true) %}
    neighbor_default:
      next_hop_self_received_evpn_routes:
        enable: true
        inter_domain: true
{%     endif %}
{% endif %}
{% if switch.vtep_ip is arista.avd.defined and evpn_hostflap_detection is arista.avd.defined %}
    evpn_hostflap_detection:
      window: {{ evpn_hostflap_detection.window | arista.avd.default(180) }}
      threshold: {{ evpn_hostflap_detection.threshold | arista.avd.default(5) }}
      enabled: {{ evpn_hostflap_detection.enabled | arista.avd.default(true) }}
{% endif %}
{% if switch.vtep_ip is arista.avd.defined and evpn_import_pruning is arista.avd.defined(true) %}
    route:
      import_match_failure_action: discard
{% endif %}
