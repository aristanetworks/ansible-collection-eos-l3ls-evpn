{% if switch.overlay.vpn_ipv4 %}
  address_family_vpn_ipv4:
{%     if switch.overlay.ler %}
    neighbor_default_encapsulation_mpls_next_hop_self:
      source_interface: Loopback0
{%     endif %}
    peer_groups:
      {{ switch.bgp_peer_groups.mpls_overlay_peers.name }}:
        activate: true
{%     if switch.mpls_overlay_role == "server" and overlay_data.mpls_rr_peers is arista.avd.defined %}
      {{ overlay_data.rr_peers_peer_group.name }}:
        activate: true
{%     endif %}
{%     if switch.overlay.dpath %}
    domain_identifier: "{{ switch.ipvpn_gateway.ipvpn_domain_id }}"
{%     endif %}
{% endif %}
