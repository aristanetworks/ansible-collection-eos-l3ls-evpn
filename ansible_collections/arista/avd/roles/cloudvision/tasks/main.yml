---
- name: Load tag information from strucutred config
  ansible.builtin.include_vars:
    file: "{{ filename }}"
  delegate_to: localhost
  when: structured_config is not defined and lookup('first_found', filename, skip=True, errors='ignore')
  vars:
    filename: "{{ structured_dir }}/{{ inventory_hostname }}.{{ avd_structured_config_file_format }}"

- name: Generate CloudVision Request
  cloudvision_convert_tags:
    cprofile_file: 'cprofile_test'
  delegate_to: localhost

- name: "Update tags on CVP"
  arista.cvp.cv_tag_v3:
    tags: "{{ cloudvision_tags }}"
    mode: assign
    auto_create: true
  delegate_to: "{{ cvp_node }}"
  when:
    - not hostvars[inventory_hostname].is_deployed is arista.avd.defined(false)
