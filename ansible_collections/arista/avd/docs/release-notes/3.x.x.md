# Release Notes For Ansible AVD 3.x.x

Documentation for AVD version `3.x.x` -> -> Placeholder update before release <-

## Release 3.0.0

Provides major enhancements and data model has been updated!

> Data model updated for roles:
> - eos_designs.
> - eos_cli_config_gen.
>
> A  [migration role](https://www.avd.sh/en/devel/roles/upgrade_tools/)  is provided to help update data structure for abstracted data model roles only, i.e. eos_designs.
-> temp link update to `\latest\` before release <-

### New Requirements

```cfg
TBD
```

### Data model modifications

This section provides an overview of only the data model that have ***changed*** from the previous release that would require user modifications. See the release notes and role documentation for all new additions.

Changes to eos_designs role:

Use migration role `arista.avd.upgrade_tools` to assist with the transition!

-  spine variables:

  - Change from `spine.{{ var }}` to `spine.defaults.{{ var }}`
  - Change from `overlay_loopback_network_summary` to `spine.defaults.loopback_ipv4_pool`
  - Change from `spine.uplinks_to_super_spine_interfaces` to `spine.defaults.uplink_interfaces`
  - New `spine.defaults.uplink_switches` variable based on keys in `super_spine.nodes`
  - Change from `max_super_spines` to `spine.defaults.max_uplink_switches`
  - Change from `max_spine_to_super_spine_links` to `spine.defaults.max_parallel_uplinks`
  - Change from `super_spine_underlay_p2p_network_summary` to `spine.defaults.uplink_ipv4_pool`
  - Change from `p2p_uplinks_ptp` to `spine.defaults.uplink_ptp`
  - Change from `spine_bgp_defaults` to `spine.defaults.bgp_defaults`
  - Change from old default value of `spine_bgp_defaults` to `spine.defaults.bgp_defaults`
  - Change from `isis_site_id.0000` to `spine.defaults.isis_system_id_prefix`
  - New `spine.defaults.isis_maximum_paths` based on max_spines * max_l3leaf_to_spine_links
  - Change from `mlag_ips.mlag_peer` to `spine.defaults.mlag_peer_ipv4_pool`
  - Change from `mlag_ips.mlag_peer_l3_ipv4_pool` to `spine.defaults.mlag_peer_l3_ipv4_pool`
  - Change from `spine.nodes.{{ node }}.super_spine_interfaces` to `spine.nodes.{{ node }}.uplink_switch_interfaces`

- l3leaf variables

  - Change from `overlay_loopback_network_summary` to `l3leaf.defaults.loopback_ipv4_pool`
  - New `loopback_network_offset variable` based on `max_spines` or length of `spine.nodes`
  - Change from `vtep_loopback_network_summary` to `l3leaf.defaults.vtep_loopback_ipv4_pool`
  - Change from `l3leaf.defaults.uplink_to_spine_interfaces` to `l3leaf.defaults.uplink_interfaces`
  - Change from `l3leaf.defaults.spines` to `l3leaf.defaults.uplink_switches`
  - Change from `max_spines` to `l3leaf.defaults.max_uplink_switches`
  - Change from `max_l3leaf_to_spine_links` to `l3leaf.defaults.max_parallel_uplinks`
  - Change from `underlay_p2p_network_summary` to `l3leaf.defaults.uplink_ipv4_pool`
  - Change from `p2p_uplinks_ptp.*` to `l3leaf.defaults.uplink_ptp.*`
  - Change from `l3leaf.defaults.p2p_link_interface_speed` to `l3leaf.defaults.uplink_interface_speed`
  - Change from `mlag_ips.mlag_peer` to `spine.defaults.mlag_peer_ipv4_pool`
  - Change from `mlag_ips.mlag_peer_l3_ipv4_pool` to `spine.defaults.mlag_peer_l3_ipv4_pool`
  - Change from `leaf_bgp_defaults` to `l3leaf.defaults.bgp_defaults`
  - Change from `old default value of leaf_bgp_defaults` to `l3leaf.defaults.bgp_defaults`
  - Change from `isis_site_id.0001` to `l3leaf.defaults.isis_system_id_prefix`
  - New `l3leaf.defaults.isis_maximum_paths` based on `max_spines` * `max_l3leaf_to_spine_links`
  - Change from `l3leaf.node_groups.{{ node_group }}.uplink_to_spine_interfaces` to `l3leaf.node_groups.{{ node_group }}.uplink_interfaces`
  - Change from `l3leaf.node_groups.{{ node_group }}.spines` to `l3leaf.node_groups.{{ node_group }}.uplink_switches`
  - Change from `l3leaf.node_groups.{{ node_group }}.p2p_link_interface_speed` to `l3leaf.node_groups.{{ node_group }}.uplink_interface_speed`
  - Change from `l3leaf.node_groups.{{ node_group }}.nodes.{{ node }}.spine_interfaces` to `l3leaf.node_groups.{{ node_group }}.nodes.{{ node }}.uplink_switch_interfaces`
  - Change from `l3leaf.node_groups.{{ node_group }}.nodes.{{ node }}.uplink_to_spine_interfaces` to `l3leaf.node_groups.{{ node_group }}.nodes.{{ node }}.uplink_interfaces`
  - Change from `l3leaf.node_groups.{{ node_group }}.nodes.{{ node }}.spines` to `l3leaf.node_groups.{{ node_group }}.nodes.{{ node }}.uplink_switches`

- l2leaf variables:
  - Change from `l2leaf.defaults.parent_l3leafs` to `l2leaf.defaults.uplink_switches`
  - Change from `l2leaf_inband_management_subnet` to `l2leaf.defaults.inband_management_subnet`
  - Change from `l2leaf_inband_management_vlan` to `l2leaf.defaults.inband_management_vlan`
  - Change from `l2leaf.defaults.p2p_link_interface_speed` to `l2leaf.defaults.uplink_interface_speed`
  - Change from `mlag_ips.mlag_peer` to `spine.defaults.mlag_peer_ipv4_pool`
  - Change from `mlag_ips.mlag_peer_l3_ipv4_pool` to `spine.defaults.mlag_peer_l3_ipv4_pool`
  - Change from `l2leaf.node_groups.{{ node_group }}.parent_l3leafs` to `l2leaf.node_groups.{{ node_group }}.uplink_switches`
  - Change from `l2leaf.node_groups.{{ node_group }}.p2p_link_interface_speed` to `l2leaf.node_groups.{{ node_group }}.uplink_interface_speed`
  - Change from `l2leaf.node_groups.{{ node_group }}.nodes.{{ node }}.l3leaf_interfaces` to `l2leaf.node_groups.{{ node_group }}.nodes.{{ node }}.uplink_switch_interfaces`
  - Change from `l2leaf.node_groups.{{ node_group }}.nodes.{{ node }}.parent_l3leafs` to `l2leaf.node_groups.{{ node_group }}.nodes.{{ node }}.uplink_switches`

- super-spine variables:

  - Change from `super_spine.{{ var }}` to `super_spine.defaults.{{ var }}
  - Change from `super_spine_loopback_network_summary` to `super_spine.defaults.loopback_ipv4_pool
  - Change from `super_spine_bgp_defaults` to `super_spine.defaults.bgp_defaults
  - Change from `old default value of super_spine_bgp_defaults` to `super_spine.defaults.bgp_defaults
  - Change in ip addressing math for P2P uplinks from spine` to `super-spine links.
    - The old model can be retained by updating` to `the v2.x.x addressing scheme:

        ```yaml
        # Node type definitions
        node_type_keys:
          spine:
            type: spine
            default_evpn_role: server
            ip_addressing:
              p2p_uplinks_ip: 'designs/l3ls-evpn/ip-addressing/avd-v2-spine-p2p-uplinks-ip.j2'
              p2p_uplinks_peer_ip: 'designs/l3ls-evpn/ip-addressing/avd-v2-spine-p2p-uplinks-peer-ip.j2'
          l3leaf:
            type: l3leaf
            connected_endpoints: true
            default_evpn_role: client
            mlag_support: true
            network_services:
              l2: true
              l3: true
            vtep: true
          l2leaf:
            type: l2leaf
            connected_endpoints: true
            mlag_support: true
            network_services:
              l2: true
            underlay_router: false
            uplink_type: port-channel
          super_spine:
            type: super-spine
          overlay_controller:
            type: overlay-controller
        ```

- overlay-controller variables:

  - Change from `overlay_controller.{{ var }}` to `overlay_controller.defaults.{{ var }}`
  - Change from `overlay_controller_loopback_network_summary` to `overlay_controller.defaults.loopback_ipv4_pool`
  - Change from `overlay_controller_p2p_bfd` to `overlay_controller.defaults.uplink_bfd`
  - Change from `overlay_controller.defaults.uplink_to_remote_switches` to `overlay_controller.defaults.uplink_interfaces`
  - Change from `overlay_controller.defaults.remote_switches` to `overlay_controller.defaults.uplink_switches`
  - Change from `max_overlay_controller_to_switch_links` (default=2) to `overlay_controller.defaults.max_uplink_switches`
    - (old algorithm expected max_overlay_controller_to_switch_links to be the sum of links to all uplink switches)
  - Change from `overlay_controller_p2p_network_summary` to `overlay_controller.defaults.uplink_ipv4_pool`
  - Change from `overlay_controller_bgp_defaults` to `overlay_controller.defaults.bgp_defaults`
  - Change from `old default value of overlay_controller_bgp_defaults` to `overlay_controller.defaults.bgp_defaults`
  - Change from `overlay_controller.nodes.{{ node }}.remote_switches_interfaces` to `overlay_controller.nodes.{{ node }}.uplink_switch_interfaces`
  - Change from `overlay_controller.nodes.{{ node }}.uplink_to_remote_switches` to `overlay_controller.defaults.uplink_interfaces`
  - Change from `overlay_controller.nodes.{{ node }}.remote_switches` to `overlay_controller.defaults.uplink_switches`

- network services variable:

  - Deprecate `evpn_rd_type.admin_subfield` == `"spine_asn"` -> use value of `spine.bgp_as`
  - Change `evpn_rd_type.admin_subfield` == `"leaf_asn"` to `bgp_as`
  - Deprecate `evpn_rt_type.admin_subfield` == `"spine_asn"` -> use value of `spine.bgp_as`
  - Change `evpn_rt_type.admin_subfield` == `"leaf_asn"` to `bgp_as`

### New Roles

  - TBD when released!

### New features

- __eos_designs (eos_l3ls_evpn):__

  - TBD when released!

- __eos_cli_config_gen:__

  - TBD when released!

- __plugins:__

  - TBD when released!

- __documentation:__

  - TBD when released!

### Fixed issues

- __eos_designs:__

  - TBD when released!

- __eos_cli_config_gen:__

  - TBD when released!

!!! info
    For detailed information please see the release tags: -> Placeholder update before release <-
